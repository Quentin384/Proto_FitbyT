<!DOCTYPE html>
<html lang="fr" class="scroll-smooth" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="dark light" />
    <title>Fit by T — Disponibilités</title>
    <meta name="description" content="Définissez vos disponibilités par jour via un calendrier et des créneaux horaires." />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

    <!-- Tailwind CSS CDN -->
    <script>
      window.tailwind = {
        theme: { extend: { container: { center: true, padding: { DEFAULT: '1rem', md: '1.5rem', lg: '2rem' } } } }
      }
    </script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>

    <!-- Styles -->
    <style>
      :root{ --bg:12 12% 6%; --card:45 16% 10%; --brand:49 88% 51%; }
      html{ font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial; }
      .bg-grid{
        background-image:
          radial-gradient(1200px 400px at 10% -10%, hsl(var(--brand)/.16), transparent 40%),
          radial-gradient(1000px 600px at 90% 0%, hsl(260 90% 66%/.16), transparent 40%),
          radial-gradient(500px 400px at 60% 110%, hsl(170 80% 60%/.14), transparent 40%),
          linear-gradient(to bottom, hsl(var(--bg)), hsl(var(--bg)));
        background-repeat:no-repeat;
      }
      .glass{ backdrop-filter:saturate(140%) blur(10px); background:hsl(var(--card)/.5); border:1px solid hsl(0 0% 100% /.08); }
      .ring-gradient{ position:relative; }
      .ring-gradient::before{
        content:""; position:absolute; inset:-1px; border-radius:16px;
        background:conic-gradient(from 0deg, hsl(var(--brand)) 0deg, transparent 120deg, transparent 240deg, hsl(var(--brand)) 360deg);
        filter:blur(.5px);
        -webkit-mask:linear-gradient(#000,#000) content-box, linear-gradient(#000,#000);
        -webkit-mask-composite:xor; mask-composite:exclude; padding:1px; pointer-events:none;
      }
      .btn{ height:2.5rem; border-radius:.65rem; padding:0 .9rem; border:1px solid hsl(0 0% 100% /.15); background:transparent; color:#fff; }
      .btn-primary{ background:hsl(var(--brand)); color:#000; border-color:transparent; font-weight:800; }
      .btn-danger{ border-color:rgba(255,255,255,.18); color:#fca5a5; }
      .field{ border-radius:.65rem; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.15); color:#fff; height:2.75rem; padding:0 .75rem; }
      .field:focus{ outline:none; box-shadow:0 0 0 2px hsl(var(--brand)/.35); border-color:hsl(var(--brand)/.6) }
      .field::placeholder{ color:rgba(255,255,255,.55); }
      .row-error{ outline:2px solid #ef4444; outline-offset:2px; border-radius:.75rem; }

      /* Calendar */
      .cal-grid{ display:grid; grid-template-columns:repeat(7,minmax(0,1fr)); gap:.45rem; }
      .cal-day{ position:relative; height:2.75rem; display:flex; align-items:center; justify-content:center; border-radius:.9rem; }
      .cal-day:hover{ background-color: rgba(255,255,255,.06); }
      .cal-day.is-muted{ opacity:.45; }
      .cal-day.is-today{ outline:2px dashed hsl(var(--brand)/.7); outline-offset:2px; }
      .cal-day.is-picked{ background:hsl(var(--brand)); color:#000; font-weight:800; }
      .cal-head{ color:rgba(255,255,255,.8); font-weight:700; display:flex; align-items:center; justify-content:center; height:2.25rem; }

      /* Badges inside calendar cells (count of slots) */
      .cal-badge{
        position:absolute; right:.35rem; top:.35rem; min-width:1.15rem; height:1.15rem;
        border-radius:9999px; background:hsl(var(--brand)); color:#111; font-weight:800;
        display:grid; place-items:center; font-size:.7rem; padding:0 .2rem;
      }

      /* Force dark native time inputs across browsers */
      input[type="time"]{ background:transparent; color:#fff; color-scheme: dark; }
      input[type="time"]::-webkit-calendar-picker-indicator{ filter: invert(1) opacity(.85); }
      input[type="time"]::-webkit-datetime-edit-fields-wrapper{ color:#fff; }
      input[type="time"]::-webkit-datetime-edit{ padding:0 0.25rem; }
      input[type="time"]::-webkit-datetime-edit-hour-field,
      input[type="time"]::-webkit-datetime-edit-minute-field,
      input[type="time"]::-webkit-datetime-edit-ampm-field{ background:transparent; color:#fff; }
      input[type="time"]::-moz-focus-inner{ border:0; }
      input[type="time"]::-ms-clear{ display:none; }

      @media(prefers-reduced-motion:no-preference){
        .hover-lift{ transition: transform .3s ease, box-shadow .3s ease; }
        .hover-lift:hover{ transform: translateY(-2px); box-shadow: 0 10px 30px hsl(var(--brand)/.18); }
      }
    </style>
  </head>

  <body class="min-h-screen bg-grid text-white antialiased selection:bg-yellow-300 selection:text-black">
    <a href="#main" class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-50 focus:px-3 focus:py-2 focus:rounded-md focus:bg-black/80 focus:text-white">Aller au contenu</a>

    <!-- Header -->
    <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-black/30 bg-black/50 border-b border-white/10">
      <div class="container flex h-16 items-center gap-3">
        <a href="index.html" class="flex items-center gap-2 group">
          <svg class="size-6 text-yellow-300" viewBox="0 0 48 48" fill="currentColor" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M13.8261 30.5736C16.7203 29.8826 20.2244 29.4783 24 29.4783C27.7756 29.4783 31.2797 29.8826 34.1739 30.5736C36.9144 31.2278 39.9967 32.7669 41.3563 33.8352L24.8486 7.36089C24.4571 6.73303 23.5429 6.73303 23.1514 7.36089L6.64374 33.8352C8.00331 32.7669 11.0856 31.2278 13.8261 30.5736Z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M39.998 35.764c-.004-.018-.01-.05-.023-.094a3.13 3.13 0 0 0-.193-.511 6.54 6.54 0 0 0-.053-.12c-1.271-.871-3.802-2.1-6.072-2.641C30.9875 31.8691 27.6413 31.4783 24 31.4783s-6.9875.3908-9.7095 1.0406c-2.29.5465-4.8462 1.7915-6.1059 2.6643-.0115.0243-.0232.0498-.0349.076-.0513.1159-.0933.2294-.1207.3298-.0262.0958-.0294.1443-.0298.1498 0 .0253.0104.3379.68485.8926.66061.5432 1.73734 1.1217 3.24421 1.6458C14.9242 39.319 19.1919 40 24 40s9.0758-.681 12.0709-1.7228c1.5069-.5241 2.5836-1.1026 3.2442-1.6458.5855-.4815.6706-.7803.6829-.8674ZM4.9518 32.7688 21.4543 6.3027c1.1745-1.8836 3.9169-1.88361 5.0914 0L43.0534 32.777c.0175.0282.0344.0568.0506.0859l-1.7477.9723c1.7477-.9723 1.7475-.9726 1.7477-.9723l.0011.0021.0014.0025.0036.0064.0098.0179c.0077.0142.0178.0328.0298.0555.0241.0452.0565.1072.0943.1826.075.1493.1756.3591.2777.6018.1684.4004.4783 1.1994.4783 2.0074 0 1.7036-.997 3.0384-2.1442 3.9818-1.1611.9548-2.7204 1.7255-4.4708 2.3343C33.8654 43.2794 29.133 44 24 44s-9.8669-.7206-13.3865-1.9448c-1.75037-.6088-3.30971-1.3795-4.47081-2.3343C4.9969 38.7775 4 37.4427 4 35.7391c0-.8666.2926-1.6469.4932-2.0998.1105-.2495.2202-.4589.3036-.6082.0421-.0755.0786-.1376.1066-.184 0 0 .0119-.0195 .0216-.0341l.0075-.0119.0051-.0082Z"/></svg>
          <span class="text-white text-lg font-extrabold tracking-tight">Fit by T</span>
        </a>

        <nav class="ml-auto hidden md:flex items-center gap-7 text-sm">
          <a class="hover:opacity-90" href="index.html">Accueil</a>
          <a class="hover:opacity-90" href="pricing.html">Tarifs</a>
          <a class="hover:opacity-90" href="booking.html">Réserver</a>
          <a class="hover:opacity-90" href="checkout.html">Paiement</a>
          <a class="hover:opacity-90" href="reservation.html">Mes séances</a>
          <a class="hover:opacity-90" href="profile.html">Profil</a>
          <a class="hover:opacity-90" href="analytics.html">Statistiques</a>
          <a class="hover:opacity-90" href="planning.html">Planning</a>
          <a class="hover:opacity-90 font-semibold text-yellow-300" href="disponibility.html" aria-current="page">Disponibilités</a>
        </nav>

        <button id="menuBtn" class="ml-auto md:hidden inline-flex items-center justify-center rounded-lg border border-white/20 size-10" aria-controls="mnav" aria-expanded="false" aria-label="Ouvrir le menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M3.75 5.25A.75.75 0 0 1 4.5 4.5h15a.75.75 0 0 1 0 1.5h-15a.75.75 0 0 1-.75-.75Zm0 7.5a.75.75 0 0 1 .75-.75h15a.75.75 0 0 1 0 1.5h-15a.75.75 0 0 1-.75-.75Zm.75 6.75a.75.75 0 0 0 0 1.5h15a.75.75 0 0 0 0-1.5h-15Z" clip-rule="evenodd"/></svg>
        </button>
      </div>
      <div id="mnav" class="hidden md:hidden border-t border-white/10">
        <nav class="container py-3 grid gap-2 text-sm">
          <a class="px-2 py-2 rounded-md hover:bg-white/5" href="index.html">Accueil</a>
          <a class="px-2 py-2 rounded-md hover:bg-white/5" href="pricing.html">Tarifs</a>
          <a class="px-2 py-2 rounded-md hover:bg-white/5" href="booking.html">Réserver</a>
          <a class="px-2 py-2 rounded-md hover:bg-white/5" href="checkout.html">Paiement</a>
          <a class="px-2 py-2 rounded-md hover:bg-white/5" href="reservation.html">Mes séances</a>
          <a class="px-2 py-2 rounded-md hover:bg-white/5" href="profile.html">Profil</a>
          <a class="px-2 py-2 rounded-md hover:bg-white/5" href="analytics.html">Statistiques</a>
          <a class="px-2 py-2 rounded-md hover:bg-white/5" href="planning.html">Planning</a>
          <a class="px-2 py-2 rounded-md bg-white/5" href="disponibility.html" aria-current="page">Disponibilités</a>
        </nav>
      </div>
    </header>

    <main id="main" class="relative">
      <section class="container py-8 md:py-12">
        <div class="flex flex-wrap items-end justify-between gap-4">
          <div class="max-w-2xl">
            <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Disponibilités</h1>
            <p class="text-white/80 mt-2">Choisissez un jour et définissez vos créneaux. (Démo locale)</p>
          </div>
        </div>
      </section>

      <section class="container pb-12 grid lg:grid-cols-[1.1fr_.9fr] gap-6 items-start">
        <!-- Calendrier -->
        <div class="ring-gradient glass rounded-2xl p-5">
          <div class="flex items-center justify-between mb-3">
            <button id="prev" class="btn" aria-label="Mois précédent">⟵</button>
            <div class="text-lg font-semibold" id="monthTitle">—</div>
            <button id="next" class="btn" aria-label="Mois suivant">⟶</button>
          </div>
          <div class="cal-grid">
            <div class="cal-head">L</div><div class="cal-head">M</div><div class="cal-head">M</div>
            <div class="cal-head">J</div><div class="cal-head">V</div><div class="cal-head">S</div><div class="cal-head">D</div>
          </div>
          <div id="calDays" class="cal-grid mt-1"></div>
          <p class="text-sm text-white/70 mt-3">Jour sélectionné : <span class="font-semibold" id="pickedLabel">—</span></p>
        </div>

        <!-- Éditeur de créneaux -->
        <div class="ring-gradient glass rounded-2xl p-5 grid gap-4">
          <div class="flex items-center justify-between gap-3">
            <h2 class="text-[22px] md:text-2xl font-extrabold tracking-tight">Créneaux du jour</h2>
            <button id="addSlot" class="btn">+ Ajouter un créneau</button>
          </div>

          <!-- Résumé du jour -->
          <div id="chips" class="flex flex-wrap gap-2 -mt-1"></div>

          <div id="slotsWrap" class="grid gap-3">
            <!-- rows -->
          </div>

          <div class="flex items-center justify-end gap-2 pt-2">
            <button id="resetDay" class="btn btn-danger">Effacer la journée</button>
            <button id="saveDay" class="btn btn-primary">Enregistrer</button>
          </div>

          <p class="text-xs text-white/60">Astuce : gardez 15–30 min de marge entre deux créneaux.</p>
        </div>
      </section>
    </main>

    <footer class="border-t border-white/10 bg-black/40">
      <div class="container py-8 grid md:grid-cols-3 gap-6 text-sm text-white/70">
        <div>
          <div class="flex items-center gap-2 mb-2">
            <svg class="size-5 text-yellow-300" viewBox="0 0 48 48" fill="currentColor" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M13.8261 30.5736C16.7203 29.8826 20.2244 29.4783 24 29.4783C27.7756 29.4783 31.2797 29.8826 34.1739 30.5736C36.9144 31.2278 39.9967 32.7669 41.3563 33.8352L24.8486 7.36089C24.4571 6.73303 23.5429 6.73303 23.1514 7.36089L6.64374 33.8352C8.00331 32.7669 11.0856 31.2278 13.8261 30.5736Z"/></svg>
            <span class="font-semibold">Fit by T</span>
          </div>
          <p>Coaching sportif personnalisé à Grenoble et en ligne.</p>
        </div>
        <nav class="grid gap-2">
          <a href="index.html" class="hover:opacity-90">Accueil</a>
          <a href="pricing.html" class="hover:opacity-90">Tarifs</a>
          <a href="booking.html" class="hover:opacity-90">Réserver</a>
          <a href="reservation.html" class="hover:opacity-90">Mes séances</a>
          <a href="profile.html" class="hover:opacity-90">Profil</a>
          <a href="analytics.html" class="hover:opacity-90">Statistiques</a>
          <a href="planning.html" class="hover:opacity-90">Planning</a>
          <a href="disponibility.html" class="hover:opacity-90">Disponibilités</a>
        </nav>
        <div class="grid gap-2">
          <a href="#" class="hover:opacity-90">Mentions légales</a>
          <a href="#" class="hover:opacity-90">Politique de confidentialité</a>
          <p class="text-xs text-white/50">© <span id="y"></span> Fit by T. Tous droits réservés.</p>
        </div>
      </div>
    </footer>

    <script>
      // Mobile nav
      (function(){
        const btn=document.getElementById('menuBtn'); const mnav=document.getElementById('mnav');
        if(!btn||!mnav) return;
        const toggle=()=>{ const open=mnav.classList.contains('hidden'); mnav.classList.toggle('hidden'); btn.setAttribute('aria-expanded', String(open)); };
        btn.addEventListener('click',e=>{ e.stopPropagation(); toggle(); });
        document.addEventListener('click',e=>{ if(!mnav.contains(e.target) && e.target!==btn){ mnav.classList.add('hidden'); btn.setAttribute('aria-expanded','false'); }});
        addEventListener('resize',()=>{ if(innerWidth>=768){ mnav.classList.add('hidden'); btn.setAttribute('aria-expanded','false'); }});
      })();

      // Year
      (function(){ const y=document.getElementById('y'); if(y) y.textContent=new Date().getFullYear(); })();

      // --------- Calendrier + Disponibilités (localStorage) ----------
      const today=new Date(); today.setHours(0,0,0,0);
      const toISO = (d)=> d.toISOString().slice(0,10);
      const fmtFRLong = new Intl.DateTimeFormat('fr-FR',{weekday:'long', day:'2-digit', month:'long', year:'numeric'});

      (function(){
        const daysHost = document.getElementById('calDays');
        const monthTitle = document.getElementById('monthTitle');
        const pickedLabel = document.getElementById('pickedLabel');
        const slotsWrap = document.getElementById('slotsWrap');
        const chips = document.getElementById('chips');

        let anchor = new Date(today.getFullYear(), today.getMonth(), 1);
        let picked = new Date(today);

        // Storage
        const KEY='fitbyT_avail_v1';
        const loadAll = ()=> JSON.parse(localStorage.getItem(KEY) || '{}');
        const saveAll = (obj)=> localStorage.setItem(KEY, JSON.stringify(obj));
        const loadDay = (iso)=> { const all=loadAll(); return Array.isArray(all[iso]) ? all[iso] : []; };
        const saveDay = (iso, slots)=> { const all=loadAll(); all[iso]=slots; saveAll(all); };

        // Utils
        const daysInMonth=(d)=> new Date(d.getFullYear(), d.getMonth()+1, 0).getDate();
        const isSameDay=(a,b)=> a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();

        function drawCalendar(){
          daysHost.innerHTML='';
          monthTitle.textContent = anchor.toLocaleDateString('fr-FR',{month:'long',year:'numeric'});
          const first = new Date(anchor.getFullYear(), anchor.getMonth(), 1);
          const startOffset = ((first.getDay()+6)%7); // Lundi=0
          const prevLast = new Date(anchor.getFullYear(), anchor.getMonth(), 0).getDate();

          // previous muted
          for(let i=startOffset; i>0; i--){
            const el=document.createElement('button');
            el.className='cal-day is-muted';
            el.textContent = String(prevLast - i + 1);
            el.disabled=true; daysHost.appendChild(el);
          }

          // current month
          const n=daysInMonth(anchor);
          for(let d=1; d<=n; d++){
            const el=document.createElement('button');
            el.className='cal-day';
            el.textContent = String(d);
            const cur = new Date(anchor.getFullYear(), anchor.getMonth(), d);
            if (isSameDay(cur, today))  el.classList.add('is-today');
            if (isSameDay(cur, picked)) el.classList.add('is-picked');

            // badge count
            const count = loadDay(toISO(cur)).length;
            if(count){
              const b=document.createElement('span');
              b.className='cal-badge';
              b.textContent=String(count);
              el.appendChild(b);
            }

            el.addEventListener('click', ()=>{ picked = cur; drawCalendar(); drawSlots(); });
            daysHost.appendChild(el);
          }

          // trailing muted
          while(daysHost.children.length % 7 !== 0){
            const el=document.createElement('button');
            el.className='cal-day is-muted'; el.textContent=''; el.disabled=true;
            daysHost.appendChild(el);
          }

          pickedLabel.textContent = fmtFRLong.format(picked);
        }

        function makeRow(sl, i, iso){
          const wrap=document.createElement('div');
          wrap.className='grid grid-cols-[1fr_1fr_auto] gap-2 items-center';
          const s=document.createElement('input');
          const e=document.createElement('input');
          const del=document.createElement('button');
          s.type='time'; e.type='time'; s.step=60; e.step=60;
          s.className='field'; e.className='field';
          s.placeholder='09:00'; e.placeholder='10:00';
          s.value = sl.start || ''; e.value = sl.end || '';
          del.textContent='Supprimer'; del.className='btn btn-danger h-11';

          const validate = ()=>{
            wrap.classList.remove('row-error');
            if(s.value && e.value && s.value >= e.value){ wrap.classList.add('row-error'); return false; }
            return true;
          };

          s.addEventListener('change', ()=>{
            const cur=loadDay(iso); if(!cur[i]) return; cur[i].start=s.value; saveDay(iso,cur);
            validate(); drawCalendar(); drawChips();
          });
          e.addEventListener('change', ()=>{
            const cur=loadDay(iso); if(!cur[i]) return; cur[i].end=e.value; saveDay(iso,cur);
            validate(); drawCalendar(); drawChips();
          });
          del.addEventListener('click', ()=>{
            const cur=loadDay(iso); cur.splice(i,1); saveDay(iso,cur);
            drawCalendar(); drawSlots();
          });

          wrap.appendChild(s); wrap.appendChild(e); wrap.appendChild(del);
          if(!validate()) wrap.classList.add('row-error');
          return wrap;
        }

        function drawChips(){
          const iso = toISO(picked);
          const slots = loadDay(iso).slice().sort((a,b)=> (a.start||'').localeCompare(b.start||''));
          chips.innerHTML='';
          if(!slots.length){ return; }
          slots.forEach(sl=>{
            const c=document.createElement('span');
            c.className='px-2.5 py-1 rounded-full text-xs font-semibold bg-white/10 ring-1 ring-white/15';
            c.textContent = sl.start && sl.end ? `${sl.start} – ${sl.end}` : 'créneau incomplet';
            chips.appendChild(c);
          });
        }

        function drawSlots(){
          const iso = toISO(picked);
          const slots = loadDay(iso);
          slotsWrap.innerHTML='';
          if(slots.length===0){
            slotsWrap.innerHTML = `
              <div class="rounded-xl bg-white/5 border border-white/10 p-4 text-white/70">
                Aucun créneau défini pour ce jour. Ajoutez-en avec “+ Ajouter un créneau”.
              </div>`;
          }else{
            slots
              .slice()
              .sort((a,b)=> (a.start||'').localeCompare(b.start||''))
              .forEach((sl,i)=> slotsWrap.appendChild( makeRow(sl, i, iso) ));
          }
          drawChips();
        }

        // Actions
        document.getElementById('prev').addEventListener('click', ()=>{ anchor.setMonth(anchor.getMonth()-1); drawCalendar(); });
        document.getElementById('next').addEventListener('click', ()=>{ anchor.setMonth(anchor.getMonth()+1); drawCalendar(); });

        document.getElementById('addSlot').addEventListener('click', ()=>{
          const iso = toISO(picked);
          const cur=loadDay(iso);
          // suggestion automatique d'un créneau qui ne chevauche pas
          const base = cur.length ? (cur.slice().sort((a,b)=>a.end.localeCompare(b.end)).at(-1).end || '09:00') : '09:00';
          const [h,m]=base.split(':').map(Number);
          const start = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
          const endH = Math.min(h+1, 23); // +1h
          const end = `${String(endH).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
          cur.push({start, end});
          saveDay(iso, cur);
          drawCalendar(); drawSlots();
        });

        document.getElementById('resetDay').addEventListener('click', ()=>{
          const iso = toISO(picked);
          saveDay(iso, []);
          drawCalendar(); drawSlots();
        });

        document.getElementById('saveDay').addEventListener('click', ()=>{
          // Validation globale
          const iso = toISO(picked);
          const cur = loadDay(iso);
          const invalid = cur.some(s=> !s.start || !s.end || s.start>=s.end);
          if(invalid){
            alert('Certains créneaux sont incomplets ou invalides (début ≥ fin).');
            return;
          }
          const btn = document.getElementById('saveDay'); const old=btn.textContent;
          btn.textContent='Enregistré ✔'; setTimeout(()=> btn.textContent=old, 1200);
        });

        // init
        drawCalendar(); drawSlots();
      })();
    </script>
  </body>
</html>
